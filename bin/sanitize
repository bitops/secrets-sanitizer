#!/usr/bin/env ruby
require 'optparse'
require 'sanitizer'
require 'yaml'


options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: example.rb [options]"

  opts.on("-mMANIFEST", "--manifest=MANIFEST", "Manifest yaml") do |m|
    options[:manifest] = m
  end
end.parse!

yaml = YAML.load_file(options[:manifest])
config_pattern = File.read(File.join(File.expand_path(File.dirname(__FILE__)), '../spec/fixture', 'config'))

patterns = []


config_pattern.each_line do |p|
  patterns << Regexp.new(p.strip)
end

Sanitizer::YamlTraverser.traverse(yaml) do |k, v, h|
  patterns.each do |p|
    unless p.match(k).nil?
      puts "#{k}: {{#{h.join('_')}}}"
      puts "#{h.join('_')}: #{v}"
    end
  end
end
